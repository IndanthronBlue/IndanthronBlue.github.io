

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" href="/img/favicon.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="阴丹士林蓝">
  <meta name="keywords" content="study note software">
  
    <meta name="description" content="本项目基于 DE1_SOC 与其扩展板 TRDB_D5M 实现了一个基于 CCD 数字相机的视频流数据的边缘检测，并且可以调整曝光时间以减少光照条件对图像边缘的影响。">
<meta property="og:type" content="article">
<meta property="og:title" content="项目报告｜基于DE1-SOC的边缘检测">
<meta property="og:url" content="http://example.com/%E9%A1%B9%E7%9B%AE%E6%8A%A5%E5%91%8A/CCD-detect/index.html">
<meta property="og:site_name" content="IndanthronBlue">
<meta property="og:description" content="本项目基于 DE1_SOC 与其扩展板 TRDB_D5M 实现了一个基于 CCD 数字相机的视频流数据的边缘检测，并且可以调整曝光时间以减少光照条件对图像边缘的影响。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/%E9%A1%B9%E7%9B%AE%E6%8A%A5%E5%91%8A/CCD-detect/1.png">
<meta property="og:image" content="http://example.com/%E9%A1%B9%E7%9B%AE%E6%8A%A5%E5%91%8A/CCD-detect/2.png">
<meta property="og:image" content="http://example.com/%E9%A1%B9%E7%9B%AE%E6%8A%A5%E5%91%8A/CCD-detect/3.png">
<meta property="og:image" content="http://example.com/%E9%A1%B9%E7%9B%AE%E6%8A%A5%E5%91%8A/CCD-detect/4.png">
<meta property="og:image" content="http://example.com/%E9%A1%B9%E7%9B%AE%E6%8A%A5%E5%91%8A/CCD-detect/5.png">
<meta property="og:image" content="http://example.com/%E9%A1%B9%E7%9B%AE%E6%8A%A5%E5%91%8A/CCD-detect/6.png">
<meta property="og:image" content="http://example.com/%E9%A1%B9%E7%9B%AE%E6%8A%A5%E5%91%8A/CCD-detect/7.png">
<meta property="og:image" content="http://example.com/%E9%A1%B9%E7%9B%AE%E6%8A%A5%E5%91%8A/CCD-detect/8.png">
<meta property="og:image" content="http://example.com/%E9%A1%B9%E7%9B%AE%E6%8A%A5%E5%91%8A/CCD-detect/9.png">
<meta property="og:image" content="http://example.com/%E9%A1%B9%E7%9B%AE%E6%8A%A5%E5%91%8A/CCD-detect/12.png">
<meta property="og:image" content="http://example.com/%E9%A1%B9%E7%9B%AE%E6%8A%A5%E5%91%8A/CCD-detect/13.png">
<meta property="og:image" content="http://example.com/%E9%A1%B9%E7%9B%AE%E6%8A%A5%E5%91%8A/CCD-detect/14.png">
<meta property="og:image" content="http://example.com/%E9%A1%B9%E7%9B%AE%E6%8A%A5%E5%91%8A/CCD-detect/15.png">
<meta property="og:image" content="http://example.com/%E9%A1%B9%E7%9B%AE%E6%8A%A5%E5%91%8A/CCD-detect/16.png">
<meta property="og:image" content="http://example.com/%E9%A1%B9%E7%9B%AE%E6%8A%A5%E5%91%8A/CCD-detect/17.png">
<meta property="og:image" content="http://example.com/%E9%A1%B9%E7%9B%AE%E6%8A%A5%E5%91%8A/CCD-detect/6.png">
<meta property="og:image" content="http://example.com/%E9%A1%B9%E7%9B%AE%E6%8A%A5%E5%91%8A/CCD-detect/7.png">
<meta property="og:image" content="http://example.com/%E9%A1%B9%E7%9B%AE%E6%8A%A5%E5%91%8A/CCD-detect/18.png">
<meta property="og:image" content="http://example.com/%E9%A1%B9%E7%9B%AE%E6%8A%A5%E5%91%8A/CCD-detect/19.png">
<meta property="og:image" content="http://example.com/%E9%A1%B9%E7%9B%AE%E6%8A%A5%E5%91%8A/CCD-detect/20.png">
<meta property="og:image" content="http://example.com/%E9%A1%B9%E7%9B%AE%E6%8A%A5%E5%91%8A/CCD-detect/22.png">
<meta property="article:published_time" content="2023-06-14T20:08:59.000Z">
<meta property="article:modified_time" content="2023-06-14T20:15:04.602Z">
<meta property="article:author" content="阴丹士林蓝">
<meta property="article:tag" content="FPGA">
<meta property="article:tag" content="项目报告">
<meta property="article:tag" content="图像处理">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://example.com/%E9%A1%B9%E7%9B%AE%E6%8A%A5%E5%91%8A/CCD-detect/1.png">
  
  
  <title>项目报告｜基于DE1-SOC的边缘检测 - IndanthronBlue</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4/github-markdown.min.css" />
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hint.css@2/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.css" />
  


<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.8.14","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":10},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 6.1.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>IndanthronBlue</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('/img/3.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="项目报告｜基于DE1-SOC的边缘检测">
              
            </span>

            
              <div class="mt-3">
  
    <span class="post-meta mr-2">
      <i class="iconfont icon-author" aria-hidden="true"></i>
      阴丹士林蓝
    </span>
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2023-06-15 04:08" pubdate>
        2023年6月15日 凌晨
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      20k 字
    </span>
  

  
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      163 分钟
    </span>
  

  
  
    
      <!-- 不蒜子统计文章PV -->
      <span id="busuanzi_container_page_pv" style="display: none">
        <i class="iconfont icon-eye" aria-hidden="true"></i>
        <span id="busuanzi_value_page_pv"></span> 次
      </span>
    
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">项目报告｜基于DE1-SOC的边缘检测</h1>
            
            <div class="markdown-body">
              <h2 id="一-项目概述"><a class="markdownIt-Anchor" href="#一-项目概述"></a> 一、项目概述</h2>
<ul>
<li>
<p>本项目基于 DE1_SOC 与其扩展板 TRDB_D5M 实现了一个<strong>基于 CCD 数字相机的视频流数据的边缘检测</strong>，并且可以调整曝光时间以减少光照条件对图像边缘的影响。</p>
</li>
<li>
<p>本项目在实验指导手册**《D5M 图像处理实验》**的基础上添加内容完成</p>
<ul>
<li>
<p>项目中CCD数据获取、RGB数据还原、VGA输出等功能模块设计参照原实验</p>
</li>
<li>
<p>项目中数字图像处理、YUV色域转换、数据矩阵转换、边缘检测等内容为作者添加完成</p>
</li>
</ul>
</li>
<li>
<p>项目最终实现效果如下：</p>
<p><img src="1.png" srcset="/img/loading.gif" lazyload alt="" /></p>
<ul>
<li>左侧为原项目输出，右侧为修改后本项目输出，对比可知基本实现了边缘检测的需求</li>
<li>图中电脑、茶杯、鼠标、键盘等轮廓清晰可见</li>
</ul>
</li>
</ul>
<hr />
<h2 id="二-开发环境"><a class="markdownIt-Anchor" href="#二-开发环境"></a> 二、开发环境</h2>
<ul>
<li>Windows 11</li>
<li>Quartus Prime Standard Edition 17.1</li>
<li>ModelSim Intel FPGA Edition 10.5b</li>
<li>Github Copilot</li>
<li>Visual Studio Code - Insiders</li>
</ul>
<hr />
<h2 id="三-设计思路"><a class="markdownIt-Anchor" href="#三-设计思路"></a> 三、设计思路</h2>
<p><img src="2.png" srcset="/img/loading.gif" lazyload alt="" /></p>
<ul>
<li>项目整体顶层模块设计如上图所示，CCD相机与板卡的交互、板卡与VGA之间的交互已经由原项目实现，笔者需要实现将CCD相机采集到的数据进行处理，使得最后显示的并不是完整的RGB色彩视频，而是边缘高亮视图</li>
</ul>
<p><img src="3.png" srcset="/img/loading.gif" lazyload alt="" /></p>
<h3 id="色域转换的设计"><a class="markdownIt-Anchor" href="#色域转换的设计"></a> 色域转换的设计</h3>
<ul>
<li>
<p>在原有项目中，CCD相机采集的单个像素的原始数据被利用<strong>插值法</strong>转换为<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>3</mn><mo>×</mo><mn>12</mn><mo>=</mo><mn>36</mn></mrow><annotation encoding="application/x-tex">3 \times 12 =36</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">3</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord">2</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">3</span><span class="mord">6</span></span></span></span>位的RGB数据，直接对RGB数据进行处理比较耗费计算资源，并且计算速度并不乐观，因此考虑将其转换为<strong>YCbCr色域</strong>，通过Y分量直接获取该帧图像的灰度直方图</p>
</li>
<li>
<p>查阅资料[<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/28766366">1</a>]可以得到RGB与YCbCr(Bt.601)色彩空间的转换公式</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><pre><code class="hljs verilog">Y =   <span class="hljs-number">0</span><span class="hljs-variable">.257</span> R&#x27; + <span class="hljs-number">0</span><span class="hljs-variable">.504</span> G&#x27; + <span class="hljs-number">0</span><span class="hljs-variable">.098</span> B&#x27; + <span class="hljs-number">16</span><br>Cb = –<span class="hljs-number">0</span><span class="hljs-variable">.148</span> R&#x27; – <span class="hljs-number">0</span><span class="hljs-variable">.291</span> G&#x27; + <span class="hljs-number">0</span><span class="hljs-variable">.439</span> B&#x27; + <span class="hljs-number">128</span><br>Cr =  <span class="hljs-number">0</span><span class="hljs-variable">.439</span> R&#x27; – <span class="hljs-number">0</span><span class="hljs-variable">.368</span> G&#x27; – <span class="hljs-number">0</span><span class="hljs-variable">.071</span> B&#x27; + <span class="hljs-number">128</span><br></code></pre></td></tr></table></figure>
<ul>
<li>
<p>考虑到Verilog不能直接进行浮点计算，因此将公式内容进行转化为无符号整数运算</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-comment">// 计算转换</span><br>Y601 =  <span class="hljs-number">16</span> + ( <span class="hljs-number">0</span><span class="hljs-variable">.257</span>*R + <span class="hljs-number">0</span><span class="hljs-variable">.504</span>*G + <span class="hljs-number">0</span><span class="hljs-variable">.098</span>*B)<br>=  <span class="hljs-number">16</span> + (<span class="hljs-number">1</span>/<span class="hljs-number">256</span>) * [ <span class="hljs-number">256</span> * (<span class="hljs-number">0</span><span class="hljs-variable">.257</span>*R + <span class="hljs-number">0</span><span class="hljs-variable">.504</span>*G + <span class="hljs-number">0</span><span class="hljs-variable">.098</span>*B) ]<br>=  <span class="hljs-number">16</span> + (<span class="hljs-number">1</span>/<span class="hljs-number">256</span>) * [ <span class="hljs-number">65</span><span class="hljs-variable">.792</span>*R + <span class="hljs-number">129</span><span class="hljs-variable">.024</span>*G + <span class="hljs-number">25</span><span class="hljs-variable">.088</span>*B ]<br>=  <span class="hljs-number">16</span> + (<span class="hljs-number">1</span>/<span class="hljs-number">256</span>) * [ <span class="hljs-number">66</span>*R + <span class="hljs-number">129</span>*G + <span class="hljs-number">25</span>*B ]  <br>=  (<span class="hljs-number">1</span>/<span class="hljs-number">256</span>) * [ <span class="hljs-number">16</span>*<span class="hljs-number">256</span> + ( <span class="hljs-number">66</span>*R + <span class="hljs-number">129</span>*G + <span class="hljs-number">25</span>*B ) ]<br>=  (<span class="hljs-number">1</span>/<span class="hljs-number">256</span>) * [ ( <span class="hljs-number">16</span>*<span class="hljs-number">256</span> + <span class="hljs-number">129</span>*G )+ ( <span class="hljs-number">66</span>*R + <span class="hljs-number">25</span>*B ) ]<br><br>Cb   = <span class="hljs-number">128</span> + (-<span class="hljs-number">0</span><span class="hljs-variable">.148</span>*R - <span class="hljs-number">0</span><span class="hljs-variable">.291</span>*G + <span class="hljs-number">0</span><span class="hljs-variable">.439</span>*B)<br>= <span class="hljs-number">128</span> + (<span class="hljs-number">1</span>/<span class="hljs-number">256</span>) * [ <span class="hljs-number">256</span> * (-<span class="hljs-number">0</span><span class="hljs-variable">.148</span>*R - <span class="hljs-number">0</span><span class="hljs-variable">.291</span>*G + <span class="hljs-number">0</span><span class="hljs-variable">.439</span>*B) ]<br>= <span class="hljs-number">128</span> + (<span class="hljs-number">1</span>/<span class="hljs-number">256</span>) * [ -<span class="hljs-number">37</span><span class="hljs-variable">.888</span>*R - <span class="hljs-number">74</span><span class="hljs-variable">.496</span>*G + <span class="hljs-number">112</span><span class="hljs-variable">.384</span>*B ]<br>= <span class="hljs-number">128</span> + (<span class="hljs-number">1</span>/<span class="hljs-number">256</span>) * [ -<span class="hljs-number">38</span>*R - <span class="hljs-number">74</span>*G + <span class="hljs-number">112</span>*B ]<br>= (<span class="hljs-number">1</span>/<span class="hljs-number">256</span>) * [ <span class="hljs-number">128</span>*<span class="hljs-number">256</span> + ( -<span class="hljs-number">38</span>*R + -<span class="hljs-number">74</span>*G + <span class="hljs-number">112</span>*B ) ]<br>= (<span class="hljs-number">1</span>/<span class="hljs-number">256</span>) * [ ( <span class="hljs-number">128</span>*<span class="hljs-number">256</span> + <span class="hljs-number">112</span>*B ) - ( <span class="hljs-number">38</span>*R + <span class="hljs-number">74</span>*G ) ]<br><br>Cr   = <span class="hljs-number">128</span> + ( <span class="hljs-number">0</span><span class="hljs-variable">.439</span>*R - <span class="hljs-number">0</span><span class="hljs-variable">.368</span>*G - <span class="hljs-number">0</span><span class="hljs-variable">.071</span>*B )<br>= <span class="hljs-number">128</span> + (<span class="hljs-number">1</span>/<span class="hljs-number">256</span>) * [ <span class="hljs-number">256</span> * ( <span class="hljs-number">0</span><span class="hljs-variable">.439</span>*R - <span class="hljs-number">0</span><span class="hljs-variable">.368</span>*G - <span class="hljs-number">0</span><span class="hljs-variable">.071</span>*B) ]<br>= <span class="hljs-number">128</span> + (<span class="hljs-number">1</span>/<span class="hljs-number">256</span>) * [ <span class="hljs-number">112</span><span class="hljs-variable">.384</span>*R - <span class="hljs-number">94</span><span class="hljs-variable">.208</span>*G - <span class="hljs-number">18</span><span class="hljs-variable">.176</span>*B ]<br>= <span class="hljs-number">128</span> + (<span class="hljs-number">1</span>/<span class="hljs-number">256</span>) * [ <span class="hljs-number">112</span>*R - <span class="hljs-number">94</span>*G - <span class="hljs-number">18</span>*B ]<br>= (<span class="hljs-number">1</span>/<span class="hljs-number">256</span>) * [ <span class="hljs-number">128</span>*<span class="hljs-number">256</span> + ( <span class="hljs-number">112</span>*R + -<span class="hljs-number">94</span>*G + -<span class="hljs-number">18</span>*B ) ]<br>= (<span class="hljs-number">1</span>/<span class="hljs-number">256</span>) * [ ( <span class="hljs-number">128</span>*<span class="hljs-number">256</span> + <span class="hljs-number">112</span>*R ) - ( <span class="hljs-number">94</span>*G + <span class="hljs-number">18</span>*B ) ]<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>转换后可以得到各分量所需要的计算资源如下：</p>
<ul>
<li>Y601 需要三个乘法器，三个加法器</li>
<li>Cb  需要三个乘法器，两个加法器，一个减法器</li>
<li>Cr  需要三个乘法器，两个加法器，一个减法器</li>
</ul>
</li>
<li>
<p>因此考虑进行一个流水线设计，将先乘再加的转换公式中乘和加的部分断开，使得乘法部分可以并行进行，减少延迟时间</p>
<ul>
<li>最后输出时需要考虑流水线的延迟节拍数</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr />
<h3 id="卷积的设计"><a class="markdownIt-Anchor" href="#卷积的设计"></a> 卷积的设计</h3>
<ul>
<li>
<p>获取到图像的灰度图后，考虑利用<strong>sobel</strong>算子对灰度图进行卷积操作，得出横向及纵向的亮度差分近似值，并据此判断边缘位置，其中难点包括将<strong>串行数据转换为矩阵</strong>、<strong>开方计算</strong>等</p>
<p><img src="4.png" srcset="/img/loading.gif" lazyload alt="" /></p>
<ul>
<li>
<p>对于矩阵数据的获取，原先是考虑使用3个双端口同步RAM，设计一个自动机控制其按照时序进行移位操作。在阅读原项目指导手册中关于插值法的介绍后，发现可以使用ip核<strong>Shift register(RAM based)</strong>[<a target="_blank" rel="noopener" href="https://www.intel.cn/content/www/cn/zh/docs/programmable/683241/21-1/shift-register-ram-based-general-description.html">2</a>]直接生成移位寄存器</p>
<p><img src="5.png" srcset="/img/loading.gif" lazyload alt="" /></p>
<ul>
<li>带taps的shift-ram就是多个普通shift-ram组合，使用带taps的shift-ram可以轻松实现行缓存，设定taps数量为<strong>2</strong>，taps间隔为一行的像素数(查阅D5M相关手册，此处为<strong>1280</strong>)，即可缓存两行。之后<strong>将这两个taps和输入像素移位进3*3窗口即可获得3*3卷积模板</strong>。</li>
</ul>
</li>
</ul>
</li>
<li>
<p>本项目使用的滤波函数是<strong>Sobel</strong>算子，它是一种是离散微分算子（discrete differentiation operator），用来计算图像灰度的近似梯度，梯度越大越有可能是边缘[<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/40491339">3</a>]。</p>
<ul>
<li>
<p>Soble算子的功能集合了高斯平滑和微分求导，又被称为一阶微分算子，求导算子，在水平和垂直两个方向上求导，得到的是图像在X方法与Y方向梯度图像。</p>
<p><img src="6.png" srcset="/img/loading.gif" lazyload alt="" /></p>
<ul>
<li>在图像的每一点，结合以上两个结果求出近似梯度：<img src="7.png" srcset="/img/loading.gif" lazyload alt="" /></li>
</ul>
</li>
<li>
<p>然后把梯度与项目中设置的阈值进行比较，<strong>大于阈值则表示该像素点为边缘，反之，则表示该像素点不是边缘</strong>。</p>
</li>
<li>
<p>计算过程中涉及到的开方考虑使用ip核来实现。</p>
</li>
</ul>
</li>
</ul>
<hr />
<h3 id="显示输出的设计"><a class="markdownIt-Anchor" href="#显示输出的设计"></a> 显示输出的设计</h3>
<ul>
<li>在原项目中，考虑到DE1_SOC 只有 1 颗 16 bit SDRAM，原项目设计了4个<strong>FIFO</strong>，作为VGA输出的缓冲区。为了复用该模块，不用重新配置ip核，项目最后还需要设计一个RGB输出模块，将得到的边缘数据转化为RGB图像输出。</li>
<li>综上所述，在完成了边缘检测后，将检测到的边缘数据转化为RGB图像，存入SDRAM缓冲模块中，之后再读出，送入VGA输出模块中。
<ul>
<li>其中需要考虑数据的截断以及时钟的分频设计</li>
</ul>
</li>
</ul>
<hr />
<h2 id="四-项目开发过程"><a class="markdownIt-Anchor" href="#四-项目开发过程"></a> 四、项目开发过程</h2>
<h3 id="导入原项目"><a class="markdownIt-Anchor" href="#导入原项目"></a> 导入原项目</h3>
<ul>
<li>
<p>在友晶terasIC的官网中的DE1-SoC主页中[<a target="_blank" rel="noopener" href="http://mail.terasic.com.cn/~dongliu/DE1_SOC/DE1_SoC_D5M_GPIO1.zip">4</a>]下载D5M项目模块相关例程，在本地解压后将DE1_SoC_CAMERA项目导入Quartus中，原项目的工程代码结构如下所示：</p>
<p><img src="8.png" srcset="/img/loading.gif" lazyload alt="" /></p>
<ul>
<li>CCD_Capture 用于获取传感器数据</li>
<li>RAW2RGB 用于还原传感器 RGB 数据</li>
<li>Sdram_Control 为 RAW2RGB 与 VGA_Controller 之间的 Buffer</li>
<li>VGA_Controller 为 VGA 控制器</li>
<li>I2C_CCD_Config 用于配置 D5M</li>
<li>Reset_Delay 用于按键检测与防抖</li>
</ul>
</li>
</ul>
<hr />
<h3 id="实现色域转换模块"><a class="markdownIt-Anchor" href="#实现色域转换模块"></a> 实现色域转换模块</h3>
<ul>
<li>根据前文所说，在实现RGB到YCrCb时进行一个流水线设计，将先乘再加的转换公式中乘和加的部分断开。因此首先需要设计并实现一个常数乘法器模块</li>
</ul>
<h4 id="实现常数乘法器模块"><a class="markdownIt-Anchor" href="#实现常数乘法器模块"></a> 实现常数乘法器模块</h4>
<ul>
<li>
<p>模块及端口定义</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-comment">//===========================================================================</span><br><span class="hljs-comment">// Module name: const_mult .v </span><br><span class="hljs-comment">// 描述: 用于RGB转换YUV的常数乘法模块</span><br><span class="hljs-comment">//===========================================================================</span><br><br><span class="hljs-meta">`<span class="hljs-keyword">timescale</span> 1ns / 10ps</span><br><br><span class="hljs-keyword">module</span> const_mult <br>    (<br>        Clock,<br>        Reset,<br>        Color,<br>        Color_Out<br>    );<br><br>    <span class="hljs-keyword">input</span> Clock; <br>    <span class="hljs-keyword">input</span> Reset; <br>    <span class="hljs-keyword">input</span> [ (IN_SIZE - <span class="hljs-number">1</span>):<span class="hljs-number">0</span>] Color; <br>    <span class="hljs-keyword">output</span>[(OUT_SIZE - <span class="hljs-number">1</span>):<span class="hljs-number">0</span>] Color_Out; <br></code></pre></td></tr></table></figure>
</li>
<li>
<p>利用parameter声明常量，使得实例化时允许传参</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-keyword">parameter</span> IN_SIZE   =  <span class="hljs-number">8</span>;<br><span class="hljs-keyword">parameter</span> OUT_SIZE  = <span class="hljs-number">16</span>;  <span class="hljs-comment">// 输出数据尺寸</span><br><span class="hljs-keyword">parameter</span> CST_MULT  = <span class="hljs-number">66</span>;  <span class="hljs-comment">// 常数乘数</span><br></code></pre></td></tr></table></figure>
</li>
<li>
<p>直接使用乘法运算符进行计算</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-comment">// ------------------------------</span><br><span class="hljs-comment">// 进行乘法计算</span><br><span class="hljs-comment">// ------------------------------</span><br><span class="hljs-keyword">always</span> @(<span class="hljs-keyword">posedge</span> Clock <span class="hljs-keyword">or</span> <span class="hljs-keyword">negedge</span> Reset)<br>    <span class="hljs-keyword">begin</span> : COLOR_KCM<br>        <span class="hljs-keyword">if</span> (!Reset)<br>            Color_Out &lt;= <span class="hljs-number">0</span>; <br>        <span class="hljs-keyword">else</span> <br>            Color_Out &lt;= CST_MULT * Color; <br>    <span class="hljs-keyword">end</span> <br></code></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="精度的考量"><a class="markdownIt-Anchor" href="#精度的考量"></a> 精度的考量</h4>
<ul>
<li>
<p>前文中对色域转换公式时，使用的是8位的量化系数（125）。通过提高系数的精度可以获得更好的精度。</p>
</li>
<li>
<p>为了得到更好的精度，减少色域转换时发生的精度损失，考虑使用以下精度：</p>
<ul>
<li>Y需要13位用于绿色和蓝色系数，需要10位用于红色系数</li>
<li>Cb需要11位用于所有系数</li>
<li>Cr需要10位用于所有系数</li>
</ul>
</li>
<li>
<p>用于计算的常数参量如下：</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-comment">// 计算分量所用的常量参数</span><br><span class="hljs-keyword">parameter</span> CST_Cr_red     = <span class="hljs-number">450</span>; <span class="hljs-comment">// 0.439 * 1024 = 449.536</span><br><span class="hljs-keyword">parameter</span> CST_Cr_green   = <span class="hljs-number">377</span>; <br><span class="hljs-keyword">parameter</span> CST_Cr_blue    =  <span class="hljs-number">73</span>; <br><span class="hljs-keyword">parameter</span> CST_Cr_Prec    =  <span class="hljs-number">10</span>; <span class="hljs-comment">//  10-bit (1024)</span><br><br><span class="hljs-keyword">parameter</span> CST_Cb_red     = <span class="hljs-number">303</span>; <br><span class="hljs-keyword">parameter</span> CST_Cb_green   = <span class="hljs-number">596</span>; <br><span class="hljs-keyword">parameter</span> CST_Cb_blue    = <span class="hljs-number">899</span>; <br><span class="hljs-keyword">parameter</span> CST_Cb_Prec    =  <span class="hljs-number">11</span>; <span class="hljs-comment">//  11-bit (2048)</span><br><br><span class="hljs-keyword">parameter</span> CST_Y601_red   = <span class="hljs-number">2105</span>; <br><span class="hljs-keyword">parameter</span> CST_Y601_green = <span class="hljs-number">4129</span>; <br><span class="hljs-keyword">parameter</span> CST_Y601_blue  =  <span class="hljs-number">803</span>; <br><span class="hljs-keyword">parameter</span> CST_Y601_Prec  =   <span class="hljs-number">13</span>; <span class="hljs-comment">//  13-bit (8192)</span><br><br><span class="hljs-comment">// 输出尺寸</span><br><span class="hljs-keyword">parameter</span> CST_Y601_OutSize = CST_Y601_Prec + OUT_SIZE; <br><span class="hljs-keyword">parameter</span> CST_Cb_OutSize   = CST_Cb_Prec   + OUT_SIZE; <br><span class="hljs-keyword">parameter</span> CST_Cr_OutSize   = CST_Cr_Prec   + OUT_SIZE; <br><span class="hljs-comment">// 偏移量</span><br><span class="hljs-keyword">parameter</span> CST_Offset_Y601  = ( ( <span class="hljs-number">33</span> &lt;&lt; (OUT_SIZE - <span class="hljs-number">8</span>) ) &lt;&lt; (CST_Y601_Prec - <span class="hljs-number">1</span>) );  <span class="hljs-comment">// (  16 + 0.5 ) * 2 * 2^(CST_Y601_Prec-1)</span><br><span class="hljs-keyword">parameter</span> CST_Offset_Cb    = ( (<span class="hljs-number">257</span> &lt;&lt; (OUT_SIZE - <span class="hljs-number">8</span>) ) &lt;&lt; (  CST_Cb_Prec - <span class="hljs-number">1</span>) );  <span class="hljs-comment">// ( 128 + 0.5 ) * 2 * 2^(CST_Cb_Prec-1)</span><br><span class="hljs-keyword">parameter</span> CST_Offset_Cr    = ( (<span class="hljs-number">257</span> &lt;&lt; (OUT_SIZE - <span class="hljs-number">8</span>) ) &lt;&lt; (  CST_Cr_Prec - <span class="hljs-number">1</span>) );  <span class="hljs-comment">// ( 128 + 0.5 ) * 2 * 2^(CST_Cr_Prec-1)</span><br></code></pre></td></tr></table></figure>
</li>
</ul>
<hr />
<h4 id="具体计算实现"><a class="markdownIt-Anchor" href="#具体计算实现"></a> 具体计算实现</h4>
<ul>
<li>
<p>根据前文设计，此处进行一个流水线设计，将先乘再加的转换公式中乘和加的部分断开，使得乘法部分可以并行进行，减少延迟时间。</p>
</li>
<li>
<p>以Cr分量的计算为例，介绍分量的计算过程</p>
<ul>
<li>
<p>首先例化三个常数乘法器，将乘法计算的中间量(R*CST_Cr_red, G*CST_Cr_green, B*CST_Cr_blue)计算出来</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-comment">// ---------------------------------</span><br><span class="hljs-comment">// 计算Cr分量</span><br><span class="hljs-comment">// ---------------------------------</span><br>const_mult <span class="hljs-variable">#(OUT_SIZE, CST_Cr_OutSize, CST_Cr_red)   Cr_KCM_red(.Clock(Clock), .Reset(Reset), .Color(R), .Color_Out(Cr_R_KCM))</span>; <br><br>const_mult <span class="hljs-variable">#(OUT_SIZE, CST_Cr_OutSize, CST_Cr_green) Cr_KCM_green(.Clock(Clock), .Reset(Reset), .Color(G), .Color_Out(Cr_G_KCM))</span>; <br><br>const_mult <span class="hljs-variable">#(OUT_SIZE, CST_Cr_OutSize, CST_Cr_blue)  Cr_KCM_blue(.Clock(Clock), .Reset(Reset), .Color(B), .Color_Out(Cr_B_KCM))</span>; <br></code></pre></td></tr></table></figure>
</li>
<li>
<p>接下来利用加法器，并行计算出最终减法的两个数(R + constant)、(G + B)</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-comment">// R + constant</span><br><span class="hljs-keyword">always</span> @(<span class="hljs-keyword">posedge</span> Clock <span class="hljs-keyword">or</span> <span class="hljs-keyword">negedge</span> Reset)<br>    <span class="hljs-keyword">begin</span> : CST_Red_Adder<br>        <span class="hljs-keyword">if</span> (!Reset)<br>            Cr_cst_R &lt;= <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">else</span> <br>            Cr_cst_R &lt;= Cr_R_KCM + CST_Offset_Cr; <span class="hljs-comment">// add 128.5 (scaled up by coefficient precision)</span><br>    <span class="hljs-keyword">end</span> <br><br><span class="hljs-comment">// G + B</span><br><span class="hljs-keyword">always</span> @(<span class="hljs-keyword">posedge</span> Clock <span class="hljs-keyword">or</span> <span class="hljs-keyword">negedge</span> Reset)<br>    <span class="hljs-keyword">begin</span> : Cr_Green_Blue_Adder<br>        <span class="hljs-keyword">if</span> (!Reset)<br>            Cr_Green_Blue &lt;= <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">else</span> <br>            Cr_Green_Blue &lt;= Cr_G_KCM + Cr_B_KCM;<br>    <span class="hljs-keyword">end</span> <br></code></pre></td></tr></table></figure>
</li>
<li>
<p>然后实现减法器，完成Cr分量的计算：Cr =&gt; (R + constant) - (G + B)</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-comment">// Cr =&gt; (R + constant) - (G + B)</span><br><span class="hljs-keyword">always</span> @(<span class="hljs-keyword">posedge</span> Clock <span class="hljs-keyword">or</span> <span class="hljs-keyword">negedge</span> Reset)<br>    <span class="hljs-keyword">begin</span> : Cr_Subt<br>        <span class="hljs-keyword">if</span> (!Reset)<br>            Cr_full &lt;= <span class="hljs-number">0</span>; <br>        <span class="hljs-keyword">else</span> <br>            Cr_full &lt;= Cr_cst_R - Cr_Green_Blue;<br>    <span class="hljs-keyword">end</span> <br></code></pre></td></tr></table></figure>
</li>
<li>
<p>最后将计算结果除以参数输出：</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-comment">// 除以参数</span><br><span class="hljs-keyword">always</span> @(Y601_full <span class="hljs-keyword">or</span> Cb_full <span class="hljs-keyword">or</span> Cr_full)<br>    <span class="hljs-keyword">begin</span><br>        Y = Y601_full [(CST_Y601_OutSize - <span class="hljs-number">1</span>):(CST_Y601_OutSize - OUT_SIZE)] ; <span class="hljs-comment">// divide by 2^(CST_Y601_OutSize-8)...</span><br>        Cb =   Cb_full [  (CST_Cb_OutSize - <span class="hljs-number">1</span>):  (CST_Cb_OutSize - OUT_SIZE)] ; <span class="hljs-comment">// divide by 2^(CST_Cb_OutSize-8)...</span><br>        Cr =   Cr_full [  (CST_Cr_OutSize - <span class="hljs-number">1</span>):  (CST_Cr_OutSize - OUT_SIZE)] ; <span class="hljs-comment">// divide by 2^(CST_Cr_OutSize-8)...</span><br>    <span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li>
<p>Y与Cb的计算和Cr类似，完整代码见附件，此处不再赘述。</p>
</li>
</ul>
<hr />
<h4 id="输出时序调整"><a class="markdownIt-Anchor" href="#输出时序调整"></a> 输出时序调整</h4>
<ul>
<li>
<p>接下来就是对时序的调整了，在上面的转换过程中，采取了四段流水线的处理方式，所以控制信号为了保持同步要打4拍。</p>
</li>
<li>
<p>因此实现 RGB2YUV_TOP 模块用于输出时序的调整</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-comment">//===========================================================================</span><br><span class="hljs-comment">// Module name: RGB2YUV_TOP .v </span><br><span class="hljs-comment">// 描述: 色域转换顶层文件，用于调整输出的时序</span><br><span class="hljs-comment">//===========================================================================</span><br><span class="hljs-meta">`<span class="hljs-keyword">timescale</span> 1ns / 10ps</span><br><br><span class="hljs-keyword">module</span> RGB2YUV_TOP (<br>    Clock,<br>    Reset,<br>    Red,<br>    Green,<br>    Blue,<br>    data_valid_in,<br>    Y,<br>    Cb,<br>    Cr,<br>    data_valid_out<br>);<br><br>  <span class="hljs-keyword">parameter</span> TOP_OUT_SIZE = <span class="hljs-number">10</span>;<br><br>  <span class="hljs-keyword">input</span> Clock;<br>  <span class="hljs-keyword">input</span> Reset;<br>  <span class="hljs-keyword">input</span> [(TOP_OUT_SIZE - <span class="hljs-number">1</span>):<span class="hljs-number">0</span>] Red;<br>  <span class="hljs-keyword">input</span> [(TOP_OUT_SIZE - <span class="hljs-number">1</span>):<span class="hljs-number">0</span>] Green;<br>  <span class="hljs-keyword">input</span> [(TOP_OUT_SIZE - <span class="hljs-number">1</span>):<span class="hljs-number">0</span>] Blue;<br>  <span class="hljs-keyword">input</span> data_valid_in;<br>  <span class="hljs-keyword">output</span> [(TOP_OUT_SIZE - <span class="hljs-number">1</span>):<span class="hljs-number">0</span>] Y;<br>  <span class="hljs-keyword">output</span> [(TOP_OUT_SIZE - <span class="hljs-number">1</span>):<span class="hljs-number">0</span>] Cb;<br>  <span class="hljs-keyword">output</span> [(TOP_OUT_SIZE - <span class="hljs-number">1</span>):<span class="hljs-number">0</span>] Cr;<br>  <span class="hljs-keyword">output</span> data_valid_out;<br><br>  <span class="hljs-keyword">reg</span> [(TOP_OUT_SIZE - <span class="hljs-number">1</span>):<span class="hljs-number">0</span>] Y;<br>  <span class="hljs-keyword">reg</span> [(TOP_OUT_SIZE - <span class="hljs-number">1</span>):<span class="hljs-number">0</span>] Cb;<br>  <span class="hljs-keyword">reg</span> [(TOP_OUT_SIZE - <span class="hljs-number">1</span>):<span class="hljs-number">0</span>] Cr;<br>  <span class="hljs-keyword">reg</span> data_valid_out;<br>  <span class="hljs-keyword">reg</span> data_valid_dly1, data_valid_dly2, data_valid_dly3, data_valid_dly4;<br>  <span class="hljs-comment">// Define internal signals</span><br>  <span class="hljs-keyword">reg</span>  [(TOP_OUT_SIZE - <span class="hljs-number">1</span>):<span class="hljs-number">0</span>] R;<br>  <span class="hljs-keyword">reg</span>  [(TOP_OUT_SIZE - <span class="hljs-number">1</span>):<span class="hljs-number">0</span>] G;<br>  <span class="hljs-keyword">reg</span>  [(TOP_OUT_SIZE - <span class="hljs-number">1</span>):<span class="hljs-number">0</span>] B;<br><br>  <span class="hljs-keyword">wire</span> [(TOP_OUT_SIZE - <span class="hljs-number">1</span>):<span class="hljs-number">0</span>] Y_sig;<br>  <span class="hljs-keyword">wire</span> [(TOP_OUT_SIZE - <span class="hljs-number">1</span>):<span class="hljs-number">0</span>] Cb_sig;<br>  <span class="hljs-keyword">wire</span> [(TOP_OUT_SIZE - <span class="hljs-number">1</span>):<span class="hljs-number">0</span>] Cr_sig;<br><br>  <span class="hljs-comment">// Input registers (should be pushed into IOBs)</span><br>  <span class="hljs-keyword">always</span> @(<span class="hljs-keyword">posedge</span> Clock <span class="hljs-keyword">or</span> <span class="hljs-keyword">negedge</span> Reset) <span class="hljs-keyword">begin</span> : In_Reg<br>    <span class="hljs-keyword">if</span> (!Reset) <span class="hljs-keyword">begin</span><br>      R &lt;= <span class="hljs-number">0</span>;<br>      G &lt;= <span class="hljs-number">0</span>;<br>      B &lt;= <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">end</span> <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (data_valid_in) <span class="hljs-keyword">begin</span><br>      R &lt;= Red;<br>      G &lt;= Green;<br>      B &lt;= Blue;<br>    <span class="hljs-keyword">end</span><br>  <span class="hljs-keyword">end</span><br><br>  <span class="hljs-comment">// Output registers (should be pushed into IOBs)</span><br>  <span class="hljs-keyword">always</span> @(<span class="hljs-keyword">posedge</span> Clock <span class="hljs-keyword">or</span> <span class="hljs-keyword">negedge</span> Reset) <span class="hljs-keyword">begin</span> : Out_Reg<br>    <span class="hljs-keyword">if</span> (!Reset) <span class="hljs-keyword">begin</span><br>      Y  &lt;= <span class="hljs-number">0</span>;<br>      Cb &lt;= <span class="hljs-number">0</span>;<br>      Cr &lt;= <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">end</span> <span class="hljs-keyword">else</span> <span class="hljs-keyword">begin</span><br>      Y  &lt;= Y_sig;<br>      Cb &lt;= Cb_sig;<br>      Cr &lt;= Cr_sig;<br>    <span class="hljs-keyword">end</span><br>  <span class="hljs-keyword">end</span><br><br><br>  <span class="hljs-comment">// CSC instantiation</span><br>  RGB2YUV <span class="hljs-variable">#(TOP_OUT_SIZE)</span> RGB2YUV (<br>      <span class="hljs-variable">.Clock</span>(Clock),<br>      <span class="hljs-variable">.Reset</span>(Reset),<br>      <span class="hljs-variable">.R</span>(R),<br>      <span class="hljs-variable">.G</span>(G),<br>      <span class="hljs-variable">.B</span>(B),<br>      <span class="hljs-variable">.Y</span>(Y_sig),<br>      <span class="hljs-variable">.Cb</span>(Cb_sig),<br>      <span class="hljs-variable">.Cr</span>(Cr_sig)<br>  );<br><br>  <span class="hljs-keyword">always</span> @(<span class="hljs-keyword">posedge</span> Clock <span class="hljs-keyword">or</span> <span class="hljs-keyword">negedge</span> Reset)<br>    <span class="hljs-keyword">if</span> (!Reset) <span class="hljs-keyword">begin</span><br>      data_valid_dly1 &lt;= <span class="hljs-number">0</span>;<br>      data_valid_dly2 &lt;= <span class="hljs-number">0</span>;<br>      data_valid_dly3 &lt;= <span class="hljs-number">0</span>;<br>      data_valid_dly4 &lt;= <span class="hljs-number">0</span>;<br>      data_valid_out  &lt;= <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">end</span> <span class="hljs-keyword">else</span> <span class="hljs-keyword">begin</span><br>      <span class="hljs-comment">// 四拍延迟</span><br>      data_valid_dly1 &lt;= data_valid_in;<br>      data_valid_dly2 &lt;= data_valid_dly1;<br>      data_valid_dly3 &lt;= data_valid_dly2;<br>      data_valid_dly4 &lt;= data_valid_dly3;<br>      data_valid_out  &lt;= data_valid_dly4;<br>    <span class="hljs-keyword">end</span><br><span class="hljs-keyword">endmodule</span><br></code></pre></td></tr></table></figure>
</li>
</ul>
<hr />
<h4 id="模块仿真验证"><a class="markdownIt-Anchor" href="#模块仿真验证"></a> 模块仿真验证</h4>
<ul>
<li>
<p>编写testbench文件，确定rgb以及其他激励信号进行仿真，用以验证色域转换模块是否正常工作</p>
</li>
<li>
<p>tb文件代码如下：</p>
<ul>
<li>
<p>模块声明以及端口定义：</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-comment">//~ `New testbench</span><br><span class="hljs-meta">`<span class="hljs-keyword">timescale</span>  1ns / 1ps</span><br><br><span class="hljs-keyword">module</span> tb_RGB2YUV_TOP;<br><br><span class="hljs-comment">// RGB2YUV_TOP Parameters</span><br><span class="hljs-keyword">parameter</span> PERIOD        = <span class="hljs-number">10</span>;<br><span class="hljs-keyword">parameter</span> TOP_OUT_SIZE  = <span class="hljs-number">10</span>;<br><br><span class="hljs-comment">// RGB2YUV_TOP Inputs</span><br><span class="hljs-keyword">reg</span>   Clock                                = <span class="hljs-number">0</span> ;<br><span class="hljs-keyword">reg</span>   Reset                                = <span class="hljs-number">0</span> ;<br><span class="hljs-keyword">reg</span>   [(TOP_OUT_SIZE - <span class="hljs-number">1</span>):<span class="hljs-number">0</span>]  Red          = <span class="hljs-number">0</span> ;<br><span class="hljs-keyword">reg</span>   [(TOP_OUT_SIZE - <span class="hljs-number">1</span>):<span class="hljs-number">0</span>]  Green        = <span class="hljs-number">0</span> ;<br><span class="hljs-keyword">reg</span>   [(TOP_OUT_SIZE - <span class="hljs-number">1</span>):<span class="hljs-number">0</span>]  Blue         = <span class="hljs-number">0</span> ;<br><span class="hljs-keyword">reg</span>   data_valid_in                        = <span class="hljs-number">0</span> ;<br><br><span class="hljs-comment">// RGB2YUV_TOP Outputs</span><br><span class="hljs-keyword">wire</span>  [(TOP_OUT_SIZE - <span class="hljs-number">1</span>):<span class="hljs-number">0</span>]  Y            ;<br><span class="hljs-keyword">wire</span>  [(TOP_OUT_SIZE - <span class="hljs-number">1</span>):<span class="hljs-number">0</span>]  Cb           ;<br><span class="hljs-keyword">wire</span>  [(TOP_OUT_SIZE - <span class="hljs-number">1</span>):<span class="hljs-number">0</span>]  Cr           ;<br><span class="hljs-keyword">wire</span>  data_valid_out                       ;<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>时钟信号生成，重置信号初始化</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-keyword">initial</span><br><span class="hljs-keyword">begin</span><br>    <span class="hljs-keyword">forever</span> <span class="hljs-variable">#(PERIOD/2)</span>  Clock=~Clock;<br><span class="hljs-keyword">end</span><br><br><span class="hljs-keyword">initial</span><br><span class="hljs-keyword">begin</span><br>    <span class="hljs-variable">#(PERIOD*2)</span> Reset  =  <span class="hljs-number">1</span>;<br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure>
</li>
<li>
<p>模块实例化</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs verilog">RGB2YUV_TOP #(<br>    <span class="hljs-variable">.TOP_OUT_SIZE</span> ( TOP_OUT_SIZE ))<br> u_RGB2YUV_TOP (<br>    <span class="hljs-variable">.Clock</span>                   ( Clock                                  ),<br>    <span class="hljs-variable">.Reset</span>                   ( Reset                                  ),<br>    <span class="hljs-variable">.Red</span>                     ( Red             [(TOP_OUT_SIZE - <span class="hljs-number">1</span>):<span class="hljs-number">0</span>] ),<br>    <span class="hljs-variable">.Green</span>                   ( Green           [(TOP_OUT_SIZE - <span class="hljs-number">1</span>):<span class="hljs-number">0</span>] ),<br>    <span class="hljs-variable">.Blue</span>                    ( Blue            [(TOP_OUT_SIZE - <span class="hljs-number">1</span>):<span class="hljs-number">0</span>] ),<br>    <span class="hljs-variable">.data_valid_in</span>           ( data_valid_in                          ),<br><br>    <span class="hljs-variable">.Y</span>                       ( Y               [(TOP_OUT_SIZE - <span class="hljs-number">1</span>):<span class="hljs-number">0</span>] ),<br>    <span class="hljs-variable">.Cb</span>                      ( Cb              [(TOP_OUT_SIZE - <span class="hljs-number">1</span>):<span class="hljs-number">0</span>] ),<br>    <span class="hljs-variable">.Cr</span>                      ( Cr              [(TOP_OUT_SIZE - <span class="hljs-number">1</span>):<span class="hljs-number">0</span>] ),<br>    <span class="hljs-variable">.data_valid_out</span>          ( data_valid_out                         )<br>);<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>激励信号生成</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-keyword">integer</span> i;<br><br><span class="hljs-keyword">initial</span><br><span class="hljs-keyword">begin</span><br>    data_valid_in = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">repeat</span> (<span class="hljs-number">3</span>) @ (<span class="hljs-keyword">posedge</span> Clock);<br>    data_valid_in = <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>;i&lt;<span class="hljs-number">10</span>;i=i+<span class="hljs-number">1</span>)<br>        <span class="hljs-keyword">begin</span><br>            Red = (i+<span class="hljs-number">1</span>)*(i+<span class="hljs-number">2</span>)*(i+<span class="hljs-number">3</span>)*<span class="hljs-number">19</span>*<span class="hljs-number">23</span>*<span class="hljs-number">29</span>*<span class="hljs-number">41</span>%<span class="hljs-number">4096</span>;<br>            Green = (i+<span class="hljs-number">1</span>)*(i+<span class="hljs-number">2</span>)*(i+<span class="hljs-number">3</span>)*<span class="hljs-number">17</span>*<span class="hljs-number">13</span>*<span class="hljs-number">31</span>*<span class="hljs-number">37</span>%<span class="hljs-number">4096</span>;<br>            Blue = (i+<span class="hljs-number">1</span>)*(i+<span class="hljs-number">2</span>)*(i+<span class="hljs-number">3</span>)*<span class="hljs-number">13</span>*<span class="hljs-number">11</span>*<span class="hljs-number">37</span>*<span class="hljs-number">41</span>%<span class="hljs-number">4096</span>;<br><br>            <span class="hljs-keyword">repeat</span> (<span class="hljs-number">1</span>) @ (<span class="hljs-keyword">posedge</span> Clock);<br>        <span class="hljs-keyword">end</span><br>    data_valid_in = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">repeat</span> (<span class="hljs-number">100</span>) @ (<span class="hljs-keyword">posedge</span> Clock);<br>    <span class="hljs-built_in">$finish</span>;<br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure>
</li>
<li>
<p>消息打印</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-keyword">always</span> @ (<span class="hljs-keyword">posedge</span> Clock)<br><span class="hljs-keyword">if</span> (data_valid_out) <span class="hljs-keyword">begin</span><br>    <span class="hljs-built_in">$display</span>(<span class="hljs-string">&quot;yuv: \t%d,\t%d,\t%d&quot;</span>,<br>        Y, Cb, Cr);<br>  <span class="hljs-keyword">end</span><br><br><span class="hljs-keyword">endmodule</span><br></code></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li>
<p>仿真结果如下：</p>
<p><img src="9.png" srcset="/img/loading.gif" lazyload alt="" /></p>
<ul>
<li>可以清楚看到流水线的正确建立的过程以及输出有效信号按照正确的时序输出</li>
<li>综上可知，色域转换模块功能以及时序正常</li>
</ul>
</li>
</ul>
<hr />
<h3 id="实现滤波模块"><a class="markdownIt-Anchor" href="#实现滤波模块"></a> 实现滤波模块</h3>
<ul>
<li>根据前文“卷积的设计”，获取到图像的灰度图后，考虑利用<strong>sobel</strong>算子对灰度图进行卷积操作，得出横向及纵向的亮度差分近似值，并据此判断边缘位置，其中难点包括将<strong>串行数据转换为矩阵</strong>、<strong>开方计算</strong>等</li>
<li>本部分的实现主要参考实验指导手册**《D5M 图像处理实验》**中关于插值法恢复RGB算法的实现</li>
</ul>
<hr />
<h4 id="获取卷积模板"><a class="markdownIt-Anchor" href="#获取卷积模板"></a> 获取卷积模板</h4>
<ul>
<li>
<p>由于Sobel算法中需要将算子与3*3的灰度图像值进行卷积运算，故需要将输入的串行灰度值转换为矩阵。此处采用<strong>移位寄存器</strong>的形式来产生矩阵序列，最大限度的节省了时钟数与内部寄存器资源。具体原理详见前文“卷积的设计”</p>
</li>
<li>
<p>首先需要创建移位寄存器IP核</p>
<p><img src="12.png" srcset="/img/loading.gif" lazyload alt="" /></p>
<ul>
<li>带taps的shift-ram就是多个普通shift-ram组合，使用带taps的shift-ram可以轻松实现行缓存，设定taps数量为<strong>2</strong>，taps间隔为一行的像素数(查阅D5M相关手册，此处为<strong>1280</strong>)，即可缓存两行。之后<strong>将这两个taps和输入像素移位进3*3窗口即可获得3*3卷积模板</strong>。</li>
</ul>
</li>
<li>
<p>编写3*3矩阵生成模块 matrix_generate_3x3_8bit</p>
<ul>
<li>
<p>模块及端⼝定义：</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-comment">//===========================================================================</span><br><span class="hljs-comment">// Module name: matrix_generate_3x3_8bit.v </span><br><span class="hljs-comment">// 描述: 3*3矩阵生成模块</span><br><span class="hljs-comment">//===========================================================================</span><br><span class="hljs-keyword">module</span> matrix_generate_3x3_8bit(<br>    <span class="hljs-keyword">input</span> clk,<br>    <span class="hljs-keyword">input</span> rst_n,<br><br>    <span class="hljs-keyword">input</span> iValid,<br>    <span class="hljs-keyword">input</span> [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>] iData,<br><br>    <span class="hljs-keyword">output</span> oValid,<br>    <span class="hljs-keyword">output</span> <span class="hljs-keyword">reg</span> [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>] oData_11, oData_12, oData_13,<br>    <span class="hljs-keyword">output</span> <span class="hljs-keyword">reg</span> [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>] oData_21, oData_22, oData_23,<br>    <span class="hljs-keyword">output</span> <span class="hljs-keyword">reg</span> [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>] oData_31, oData_32, oData_33<br>);<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>实例化移位寄存器，实现行缓存：</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-keyword">reg</span> [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>] row3_data;<br><span class="hljs-keyword">wire</span> [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>] row2_data;<br><span class="hljs-keyword">wire</span> [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>] row1_data;<br><span class="hljs-keyword">reg</span> [<span class="hljs-number">1</span>:<span class="hljs-number">0</span>] Valid_shift;<br><br><span class="hljs-comment">// shift_ram实现2行缓存</span><br>line_shift_ram inst_line_shift_ram(<br>    <span class="hljs-variable">.clock</span>    (clk),<br>    <span class="hljs-variable">.clken</span>    (iValid),<br>    <span class="hljs-variable">.shiftin</span>  (row3_data),<br>    <span class="hljs-variable">.taps0x</span>   (row2_data),<br>    <span class="hljs-variable">.taps1x</span>   (row1_data),<br>    <span class="hljs-variable">.shiftout</span> ()<br>);<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>将输入数据寄存作为窗口第三行起始数据，同时也作为行缓存的输入:</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-comment">// 将输入数据寄存作为窗口第三行起始数据，同时也作为行缓存的输入</span><br><span class="hljs-keyword">always</span> @(<span class="hljs-keyword">posedge</span> clk, <span class="hljs-keyword">negedge</span> rst_n) <span class="hljs-keyword">begin</span><br>    <span class="hljs-keyword">if</span>(!rst_n)<br>        row3_data &lt;= <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(iValid)<br>        row3_data &lt;= iData;<br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure>
</li>
<li>
<p>获取3*3卷积模板</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-comment">// 获取3x3卷积模板</span><br><span class="hljs-keyword">always</span> @(<span class="hljs-keyword">posedge</span> clk, <span class="hljs-keyword">negedge</span> rst_n) <span class="hljs-keyword">begin</span><br>    <span class="hljs-keyword">if</span>(!rst_n) <span class="hljs-keyword">begin</span><br>        &#123;oData_11, oData_12, oData_13&#125; &lt;= <span class="hljs-number">3&#x27;b000</span>;<br>        &#123;oData_21, oData_22, oData_23&#125; &lt;= <span class="hljs-number">3&#x27;b000</span>;<br>        &#123;oData_31, oData_32, oData_33&#125; &lt;= <span class="hljs-number">3&#x27;b000</span>;<br>    <span class="hljs-keyword">end</span> <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(iValid) <span class="hljs-keyword">begin</span><br>        &#123;oData_11, oData_12, oData_13&#125; &lt;= &#123;oData_12, oData_13, row1_data&#125;;<br>        &#123;oData_21, oData_22, oData_23&#125; &lt;= &#123;oData_22, oData_23, row2_data&#125;;<br>        &#123;oData_31, oData_32, oData_33&#125; &lt;= &#123;oData_32, oData_33, row3_data&#125;;<br>    <span class="hljs-keyword">end</span><br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure>
</li>
<li>
<p>控制信号打两拍输出，原因和流水线延迟类似</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-comment">// iValid打两拍输出</span><br><span class="hljs-keyword">always</span> @(<span class="hljs-keyword">posedge</span> clk, <span class="hljs-keyword">negedge</span> rst_n) <span class="hljs-keyword">begin</span><br>    <span class="hljs-keyword">if</span>(!rst_n)<br>        Valid_shift &lt;=  <span class="hljs-number">2&#x27;b00</span>;<br>    <span class="hljs-keyword">else</span><br>        Valid_shift &lt;= &#123;Valid_shift[<span class="hljs-number">0</span>], iValid&#125;;<br><span class="hljs-keyword">end</span><br><br><span class="hljs-keyword">assign</span> oValid = Valid_shift[<span class="hljs-number">1</span>];<br></code></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<hr />
<h4 id="矩阵获取模块仿真"><a class="markdownIt-Anchor" href="#矩阵获取模块仿真"></a> 矩阵获取模块仿真</h4>
<ul>
<li>
<p>简单起见，只仿真三行，每行1280个像素</p>
</li>
<li>
<p>仿真文件编码如下：</p>
<ul>
<li>
<p>模块声明以及端口定义：</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-comment">//~ `New testbench</span><br><span class="hljs-meta">`<span class="hljs-keyword">timescale</span>  1ns / 1ps</span><br><br><span class="hljs-keyword">module</span> tb_matrix_generate_3x3_8bit;   <br><br><span class="hljs-comment">// matrix_generate_3x3_8bit Parameters</span><br><span class="hljs-keyword">parameter</span> PERIOD  = <span class="hljs-number">10</span>;<br><br><br><span class="hljs-comment">// matrix_generate_3x3_8bit Inputs</span><br><span class="hljs-keyword">reg</span>   clk                                  = <span class="hljs-number">0</span> ;<br><span class="hljs-keyword">reg</span>   rst_n                                = <span class="hljs-number">0</span> ;<br><span class="hljs-keyword">reg</span>   iValid                               = <span class="hljs-number">0</span> ;<br><span class="hljs-keyword">reg</span>   [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>]  iData                         = <span class="hljs-number">0</span> ;<br><br><span class="hljs-comment">// matrix_generate_3x3_8bit Outputs</span><br><span class="hljs-keyword">wire</span>  oValid                               ;<br><span class="hljs-keyword">wire</span>  [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>]  oData_11                      ;<br><span class="hljs-keyword">wire</span>  [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>]  oData_12                      ;<br><span class="hljs-keyword">wire</span>  [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>]  oData_13                      ;<br><span class="hljs-keyword">wire</span>  [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>]  oData_21                      ;<br><span class="hljs-keyword">wire</span>  [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>]  oData_22                      ;<br><span class="hljs-keyword">wire</span>  [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>]  oData_23                      ;<br><span class="hljs-keyword">wire</span>  [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>]  oData_31                      ;<br><span class="hljs-keyword">wire</span>  [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>]  oData_32                      ;<br><span class="hljs-keyword">wire</span>  [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>]  oData_33                      ;<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>生成时钟信号并初始化重置信号</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-keyword">initial</span><br><span class="hljs-keyword">begin</span><br>    <span class="hljs-keyword">forever</span> <span class="hljs-variable">#(PERIOD)</span>  clk=~clk;<br><span class="hljs-keyword">end</span><br><br><span class="hljs-keyword">initial</span><br><span class="hljs-keyword">begin</span><br>    <span class="hljs-variable">#(PERIOD*2)</span> rst_n  =  <span class="hljs-number">1</span>;<br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure>
</li>
<li>
<p>实例化模块</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs verilog">matrix_generate_3x3_8bit  u_matrix_generate_3x3_8bit (<br>    <span class="hljs-variable">.clk</span>                     ( clk             ),<br>    <span class="hljs-variable">.rst_n</span>                   ( rst_n           ),<br>    <span class="hljs-variable">.iValid</span>                  ( iValid          ),<br>    <span class="hljs-variable">.iData</span>                   ( iData     [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>] ),<br><br>    <span class="hljs-variable">.oValid</span>                  ( oValid          ),<br>    <span class="hljs-variable">.oData_11</span>                ( oData_11  [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>] ),<br>    <span class="hljs-variable">.oData_12</span>                ( oData_12  [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>] ),<br>    <span class="hljs-variable">.oData_13</span>                ( oData_13  [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>] ),<br>    <span class="hljs-variable">.oData_21</span>                ( oData_21  [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>] ),<br>    <span class="hljs-variable">.oData_22</span>                ( oData_22  [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>] ),<br>    <span class="hljs-variable">.oData_23</span>                ( oData_23  [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>] ),<br>    <span class="hljs-variable">.oData_31</span>                ( oData_31  [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>] ),<br>    <span class="hljs-variable">.oData_32</span>                ( oData_32  [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>] ),<br>    <span class="hljs-variable">.oData_33</span>                ( oData_33  [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>] )<br>);<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>生成激励信号</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-keyword">initial</span><br><span class="hljs-keyword">begin</span><br>    #<span class="hljs-number">20</span> rst_n &lt;= <span class="hljs-number">1&#x27;b1</span>;<br>        #<span class="hljs-number">20</span> iValid &lt;= <span class="hljs-number">1&#x27;b1</span>;<br><br>        <span class="hljs-comment">// 第一行数据</span><br>        <span class="hljs-keyword">repeat</span>(<span class="hljs-number">1280</span>) <span class="hljs-keyword">begin</span><br>            iData &lt;= <span class="hljs-built_in">$random</span>;<br>            #<span class="hljs-number">20</span>;<br>        <span class="hljs-keyword">end</span><br>        iValid &lt;= <span class="hljs-number">1&#x27;b0</span>;<br><br>        #<span class="hljs-number">100</span> iValid &lt;= <span class="hljs-number">1&#x27;b1</span>;<br>        <span class="hljs-comment">// 第二行数据</span><br>        <span class="hljs-keyword">repeat</span>(<span class="hljs-number">1280</span>) <span class="hljs-keyword">begin</span><br>            iData &lt;= <span class="hljs-built_in">$random</span>;<br>            #<span class="hljs-number">20</span>;<br>        <span class="hljs-keyword">end</span><br>        iValid &lt;= <span class="hljs-number">1&#x27;b0</span>;<br><br>        #<span class="hljs-number">100</span> iValid &lt;= <span class="hljs-number">1&#x27;b1</span>;<br>        <span class="hljs-comment">// 第三行数据</span><br>        <span class="hljs-keyword">repeat</span>(<span class="hljs-number">1280</span>) <span class="hljs-keyword">begin</span><br>            iData &lt;= <span class="hljs-built_in">$random</span>;<br>            #<span class="hljs-number">20</span>;<br>        <span class="hljs-keyword">end</span><br>        #<span class="hljs-number">500</span> <span class="hljs-built_in">$stop</span>;<br>    <span class="hljs-built_in">$finish</span>;<br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li>
<p>仿真结果如下图所示</p>
<p><img src="13.png" srcset="/img/loading.gif" lazyload alt="" /></p>
<ul>
<li>可以看出，3*3卷积模板的第三行最先出现，然后是第二行，最后才是第一行。</li>
</ul>
</li>
<li>
<p>深入到各行数据可得：</p>
<p><img src="14.png" srcset="/img/loading.gif" lazyload alt="" /></p>
<ul>
<li>输入像素第一行的最前面几个像素如图，前三个为36,129,9</li>
</ul>
<p><img src="15.png" srcset="/img/loading.gif" lazyload alt="" /></p>
<ul>
<li>输入像素第二行最前面几个像素如图，前三个像素为121, 205, 146</li>
</ul>
<p><img src="16.png" srcset="/img/loading.gif" lazyload alt="" /></p>
<ul>
<li>输入像素第三行最前面几个像素如图，前三个像素为89, 64, 233</li>
</ul>
<p><img src="17.png" srcset="/img/loading.gif" lazyload alt="" /></p>
<ul>
<li>上图黄色竖线处即可看到oData11 ~ oData33为36,129,9,121,205,146,89,64,233，正是每一行的前三个像素。</li>
</ul>
</li>
<li>
<p>综上可知，该卷积模板最开始时只有右下角一个像素，然后向右移动，遍历完一行就遍历下一行。</p>
</li>
</ul>
<hr />
<h4 id="实现边缘检测计算"><a class="markdownIt-Anchor" href="#实现边缘检测计算"></a> 实现边缘检测计算</h4>
<ul>
<li>
<p>获得了卷积模板后即可进行边缘检测计算</p>
</li>
<li>
<p>本项目使用的滤波函数是<strong>Sobel</strong>算子，它是一种是离散微分算子（discrete differentiation operator），用来计算图像灰度的近似梯度，梯度越大越有可能是边缘[<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/40491339">3</a>]。</p>
<ul>
<li>
<p>Soble算子的功能集合了高斯平滑和微分求导，又被称为一阶微分算子，求导算子，在水平和垂直两个方向上求导，得到的是图像在X方法与Y方向梯度图像。</p>
<p><img src="6.png" srcset="/img/loading.gif" lazyload alt="" /></p>
<ul>
<li>在图像的每一点，结合以上两个结果求出近似梯度：<img src="7.png" srcset="/img/loading.gif" lazyload alt="" /></li>
</ul>
</li>
<li>
<p>然后把梯度与项目中设置的阈值进行比较，<strong>大于阈值则表示该像素点为边缘，反之，则表示该像素点不是边缘</strong>。</p>
</li>
</ul>
</li>
<li>
<p>实现过程如下：</p>
<ul>
<li>
<p>模块声明与端口定义</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-comment">//===========================================================================</span><br><span class="hljs-comment">// Module name: sobel_edge_detector.v </span><br><span class="hljs-comment">// 描述: 边缘检测模块</span><br><span class="hljs-comment">//===========================================================================</span><br><span class="hljs-keyword">module</span> sobel_edge_detector (<br>    aclr,<br>    data_valid_in,<br>    clk,<br>    data,<br>    result<br>);<br>  <span class="hljs-keyword">input</span> aclr;<br>  <span class="hljs-keyword">input</span> data_valid_in;<br>  <span class="hljs-keyword">input</span> clk;<br>  <span class="hljs-keyword">input</span> [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>] data;<br>  <span class="hljs-keyword">output</span> [<span class="hljs-number">23</span>:<span class="hljs-number">0</span>] result;<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>参数、连线与寄存器定义</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-keyword">parameter</span> SOBEL_THRESHOLD = <span class="hljs-number">256</span>;  <span class="hljs-comment">//sobel阈值</span><br><br><span class="hljs-comment">// 矩阵数据=====================</span><br><span class="hljs-keyword">wire</span> oValid;<br><span class="hljs-keyword">wire</span> [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>] oData_11;<br><span class="hljs-keyword">wire</span> [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>] oData_12;<br><span class="hljs-keyword">wire</span> [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>] oData_13;<br><span class="hljs-keyword">wire</span> [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>] oData_21;<br><span class="hljs-keyword">wire</span> [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>] oData_22;<br><span class="hljs-keyword">wire</span> [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>] oData_23;<br><span class="hljs-keyword">wire</span> [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>] oData_31;<br><span class="hljs-keyword">wire</span> [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>] oData_32;<br><span class="hljs-keyword">wire</span> [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>] oData_33;<br><span class="hljs-comment">// =============================</span><br><br><span class="hljs-keyword">reg</span> [<span class="hljs-number">9</span>:<span class="hljs-number">0</span>] gx_temp2;  <span class="hljs-comment">//第三列值</span><br><span class="hljs-keyword">reg</span> [<span class="hljs-number">9</span>:<span class="hljs-number">0</span>] gx_temp1;  <span class="hljs-comment">//第一列值</span><br><span class="hljs-keyword">reg</span> [<span class="hljs-number">9</span>:<span class="hljs-number">0</span>] gx_data;  <span class="hljs-comment">//x方向的偏导数</span><br><span class="hljs-keyword">reg</span> [<span class="hljs-number">9</span>:<span class="hljs-number">0</span>] gy_temp1;  <span class="hljs-comment">//第一行值</span><br><span class="hljs-keyword">reg</span> [<span class="hljs-number">9</span>:<span class="hljs-number">0</span>] gy_temp2;  <span class="hljs-comment">//第三行值</span><br><span class="hljs-keyword">reg</span> [<span class="hljs-number">9</span>:<span class="hljs-number">0</span>] gy_data;  <span class="hljs-comment">//y方向的偏导数</span><br><span class="hljs-keyword">reg</span> [<span class="hljs-number">20</span>:<span class="hljs-number">0</span>] gxy_square;<br><span class="hljs-keyword">reg</span> data_valid_out;<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>矩阵获取模块实例化</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs verilog">matrix_generate_3x3_8bit inst_filter_3x3 (<br>    <span class="hljs-variable">.clk</span>     (clk),<br>    <span class="hljs-variable">.rst_n</span>   (aclr),<br>    <span class="hljs-variable">.iValid</span>  (data_valid_in),<br>    <span class="hljs-variable">.iData</span>   (data),<br>    <span class="hljs-variable">.oValid</span>  (oValid),<br>    <span class="hljs-variable">.oData_11</span>(oData_11),<br>    <span class="hljs-variable">.oData_12</span>(oData_12),<br>    <span class="hljs-variable">.oData_13</span>(oData_13),<br>    <span class="hljs-variable">.oData_21</span>(oData_21),<br>    <span class="hljs-variable">.oData_22</span>(oData_22),<br>    <span class="hljs-variable">.oData_23</span>(oData_23),<br>    <span class="hljs-variable">.oData_31</span>(oData_31),<br>    <span class="hljs-variable">.oData_32</span>(oData_32),<br>    <span class="hljs-variable">.oData_33</span>(oData_33)<br>);<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>利用 Sobel 算子进行计算</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-comment">//Sobel 算子</span><br><span class="hljs-comment">//         gx                  gy                  像素点</span><br><span class="hljs-comment">// [   -1  0   +1  ]   [   +1  +2   +1 ]     [   P11  P12   P13 ]</span><br><span class="hljs-comment">// [   -2  0   +2  ]   [   0   0    0  ]     [   P21  P22   P23 ]</span><br><span class="hljs-comment">// [   -1  0   +1  ]   [   -1  -2   -1 ]     [   P31  P32   P33 ]</span><br></code></pre></td></tr></table></figure>
<ul>
<li>
<p>Step 1 计算x方向的偏导数</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-keyword">always</span> @(<span class="hljs-keyword">posedge</span> clk <span class="hljs-keyword">or</span> <span class="hljs-keyword">negedge</span> aclr) <span class="hljs-keyword">begin</span><br>    <span class="hljs-keyword">if</span> (!aclr) <span class="hljs-keyword">begin</span><br>        gy_temp1 &lt;= <span class="hljs-number">10&#x27;d0</span>;<br>        gy_temp2 &lt;= <span class="hljs-number">10&#x27;d0</span>;<br>        gy_data  &lt;= <span class="hljs-number">10&#x27;d0</span>;<br>    <span class="hljs-keyword">end</span> <span class="hljs-keyword">else</span> <span class="hljs-keyword">begin</span><br>        gy_temp1 &lt;= oData_13 + (oData_23 &lt;&lt; <span class="hljs-number">1</span>) + oData_33;<br>        gy_temp2 &lt;= oData_11 + (oData_21 &lt;&lt; <span class="hljs-number">1</span>) + oData_31;<br>        gy_data  &lt;= (gy_temp1 &gt;= gy_temp2) ? gy_temp1 - gy_temp2 : (gy_temp2 - gy_temp1);<br>    <span class="hljs-keyword">end</span><br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure>
</li>
<li>
<p>Step 2 计算y方向的偏导数</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-keyword">always</span> @(<span class="hljs-keyword">posedge</span> clk <span class="hljs-keyword">or</span> <span class="hljs-keyword">negedge</span> aclr) <span class="hljs-keyword">begin</span><br>    <span class="hljs-keyword">if</span> (!aclr) <span class="hljs-keyword">begin</span><br>        gx_temp1 &lt;= <span class="hljs-number">10&#x27;d0</span>;<br>        gx_temp2 &lt;= <span class="hljs-number">10&#x27;d0</span>;<br>        gx_data  &lt;= <span class="hljs-number">10&#x27;d0</span>;<br>    <span class="hljs-keyword">end</span> <span class="hljs-keyword">else</span> <span class="hljs-keyword">begin</span><br>        gx_temp1 &lt;= oData_11 + (oData_12 &lt;&lt; <span class="hljs-number">1</span>) + oData_13;<br>        gx_temp2 &lt;= oData_31 + (oData_32 &lt;&lt; <span class="hljs-number">1</span>) + oData_33;<br>        gx_data  &lt;= (gx_temp1 &gt;= gx_temp2) ? gx_temp1 - gx_temp2 : (gx_temp2 - gx_temp1);<br>    <span class="hljs-keyword">end</span><br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure>
</li>
<li>
<p>Step 3 计算平方和</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-keyword">always</span> @(<span class="hljs-keyword">posedge</span> clk <span class="hljs-keyword">or</span> <span class="hljs-keyword">negedge</span> aclr) <span class="hljs-keyword">begin</span><br>    <span class="hljs-keyword">if</span> (!aclr) gxy_square &lt;= <span class="hljs-number">21&#x27;d0</span>;<br>    <span class="hljs-keyword">else</span> gxy_square &lt;= gx_data * gx_data + gy_data * gy_data;<br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure>
</li>
<li>
<p>Step 4 开平方（梯度向量的大小）</p>
<ul>
<li>
<p>首先创建开方计算IP核</p>
<p><img src="18.png" srcset="/img/loading.gif" lazyload alt="" /></p>
</li>
<li>
<p>然后将该模块实例化</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-keyword">wire</span> [<span class="hljs-number">10</span>:<span class="hljs-number">0</span>] squart_out;<br>sqrt u1_altsquart (  <span class="hljs-comment">//例化开平方的ip核</span><br>    <span class="hljs-variable">.radical</span>  (gxy_square),<br>    <span class="hljs-variable">.q</span>        (squart_out),  <span class="hljs-comment">//输出的结果</span><br>    <span class="hljs-variable">.remainder</span>()<br>);<br></code></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li>
<p>Step 5 将开平方后的数据与预设阈值比较</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-keyword">reg</span> post_img_bit_r;<br><span class="hljs-keyword">always</span>@(<span class="hljs-keyword">posedge</span> clk <span class="hljs-keyword">or</span> <span class="hljs-keyword">negedge</span> aclr)<span class="hljs-keyword">begin</span><br>    <span class="hljs-keyword">if</span>(!aclr)<br>        post_img_bit_r &lt;= <span class="hljs-number">1&#x27;b0</span>; <span class="hljs-comment">//初始值</span><br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(squart_out &gt;= SOBEL_THRESHOLD)<br>        post_img_bit_r &lt;= <span class="hljs-number">1&#x27;b1</span>; <span class="hljs-comment">//检测到边缘1</span><br>    <span class="hljs-keyword">else</span><br>        post_img_bit_r &lt;= <span class="hljs-number">1&#x27;b0</span>; <span class="hljs-comment">//不是边缘 0</span><br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li>
<p>最后根据是否存在边缘信息，生成24(3*8)位结果输出，该结果实质上是将是否存在边缘转化为二值化的RGB信息，拼接后输出</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-keyword">assign</span>  result = &#123;<span class="hljs-number">24</span>&#123;post_img_bit_r&#125;&#125;;<br></code></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<hr />
<h3 id="实现显示输出"><a class="markdownIt-Anchor" href="#实现显示输出"></a> 实现显示输出</h3>
<ul>
<li>
<p>为了复用原有项目中的 FIFO SDRAM 作为 VGA 输出的缓存，需要将边缘检测计算模块输出的边缘信息转化为RGB色彩信息再输出</p>
</li>
<li>
<p>只需额外编写一个一个模块，将边缘检测模块输出的拼接后的RGB二值信息拆分后输出即可，具体实现代码如下：</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-comment">//===========================================================================</span><br><span class="hljs-comment">// Module name: edge_output.v </span><br><span class="hljs-comment">// 描述: 边缘数据输出模块</span><br><span class="hljs-comment">//===========================================================================</span><br><br><span class="hljs-keyword">module</span> edge_output(<br>  <span class="hljs-keyword">input</span>            clk,<br>  <span class="hljs-keyword">input</span>            rst_n,<br>  <span class="hljs-keyword">input</span>      [<span class="hljs-number">23</span>:<span class="hljs-number">0</span>] data,<br>  <span class="hljs-keyword">output</span> <span class="hljs-keyword">reg</span> [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>] o_r,<br>  <span class="hljs-keyword">output</span> <span class="hljs-keyword">reg</span> [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>] o_g,<br>  <span class="hljs-keyword">output</span> <span class="hljs-keyword">reg</span> [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>] o_b<br>);<br><br><span class="hljs-keyword">always</span>@(<span class="hljs-keyword">posedge</span> clk <span class="hljs-keyword">or</span> <span class="hljs-keyword">negedge</span> rst_n) <span class="hljs-keyword">begin</span><br>  <span class="hljs-keyword">if</span> (!rst_n) <span class="hljs-keyword">begin</span><br>    o_r &lt;= &#123;<span class="hljs-number">8</span>&#123;<span class="hljs-number">1&#x27;b0</span>&#125;&#125;;<br>    o_g &lt;= &#123;<span class="hljs-number">8</span>&#123;<span class="hljs-number">1&#x27;b0</span>&#125;&#125;;<br>    o_b &lt;= &#123;<span class="hljs-number">8</span>&#123;<span class="hljs-number">1&#x27;b0</span>&#125;&#125;;<br>  <span class="hljs-keyword">end</span><br>  <span class="hljs-keyword">else</span> <span class="hljs-keyword">begin</span><br>   o_r &lt;= data[<span class="hljs-number">7</span>:<span class="hljs-number">0</span>];<br>   o_g &lt;= data[<span class="hljs-number">15</span>:<span class="hljs-number">8</span>];<br>   o_b &lt;= data[<span class="hljs-number">23</span>:<span class="hljs-number">16</span>];<br>  <span class="hljs-keyword">end</span><br><span class="hljs-keyword">end</span><br><br><span class="hljs-keyword">endmodule</span><br></code></pre></td></tr></table></figure>
</li>
</ul>
<hr />
<h3 id="修改顶层文件"><a class="markdownIt-Anchor" href="#修改顶层文件"></a> 修改顶层文件</h3>
<ul>
<li>
<p>添加色域转换模块实例，并定义其连线接口</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-keyword">wire</span> data_valid_out;<br><span class="hljs-keyword">wire</span> [<span class="hljs-number">9</span>:<span class="hljs-number">0</span>] Y,Cb,Cr;<br>RGB2YUV_TOP u9 (<br>    <span class="hljs-variable">.Clock</span>(D5M_PIXLCLK), <br>    <span class="hljs-variable">.Reset</span>(DLY_RST_1), <br>    <span class="hljs-variable">.Red</span>(sCCD_R), <br>    <span class="hljs-variable">.Green</span>(sCCD_G), <br>    <span class="hljs-variable">.Blue</span>(sCCD_B), <br>    <span class="hljs-variable">.data_valid_in</span>(sCCD_DVAL), <br>    <span class="hljs-variable">.Y</span>(Y), <br>    <span class="hljs-variable">.Cb</span>(Cb), <br>    <span class="hljs-variable">.Cr</span>(Cr), <br>    <span class="hljs-variable">.data_valid_out</span>(data_valid_out)<br>);<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>添加边缘检测模块实例，并定义其连线接口</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-keyword">wire</span> [<span class="hljs-number">23</span>:<span class="hljs-number">0</span>] result;<br>sobel_edge_detector u10 (<br>    <span class="hljs-variable">.clk</span>(D5M_PIXLCLK), <br>    <span class="hljs-variable">.aclr</span>(DLY_RST_1), <br>    <span class="hljs-variable">.data_valid_in</span>(data_valid_out), <br>    <span class="hljs-variable">.data</span>(Y[<span class="hljs-number">9</span>:<span class="hljs-number">2</span>]), <br>    <span class="hljs-variable">.result</span>(result)<br>);<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>添加边缘信息输出模块实例，并定义其连线接口</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-comment">//RGB data convert to gray data</span><br>edge_output u11 (<br>    <span class="hljs-variable">.clk</span>  (D5M_PIXLCLK),<br>    <span class="hljs-variable">.rst_n</span>(DLY_RST_2),<br>    <span class="hljs-variable">.data</span>(result),<br>    <span class="hljs-variable">.o_r</span>  (w_r),<br>    <span class="hljs-variable">.o_g</span>  (w_g),<br>    <span class="hljs-variable">.o_b</span>  (w_b)<br>);<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>修改SDRAM模块，将输出的边缘信息通过FIFO写入到SDRAM中，作为VGA输出</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-comment">//SDRam Read and Write as Frame Buffer</span><br>Sdram_Control u7 (  <span class="hljs-comment">//	HOST Side						</span><br>    <span class="hljs-variable">.RESET_N</span>(KEY[<span class="hljs-number">0</span>]),<br>    <span class="hljs-variable">.CLK</span>(sdram_ctrl_clk),<br><br>    <span class="hljs-comment">//	FIFO Write Side 1</span><br>    <span class="hljs-variable">.WR1_DATA</span>(&#123;<span class="hljs-number">1&#x27;b0</span>, w_g[<span class="hljs-number">9</span>:<span class="hljs-number">5</span>], w_b[<span class="hljs-number">9</span>:<span class="hljs-number">0</span>]&#125;),<br>    <span class="hljs-variable">.WR1</span>(sCCD_DVAL),<br>    <span class="hljs-variable">.WR1_ADDR</span>(<span class="hljs-number">0</span>),<br>    <span class="hljs-variable">.WR1_MAX_ADDR</span>(<span class="hljs-number">640</span> * <span class="hljs-number">480</span>),<br>    <span class="hljs-variable">.WR1_LENGTH</span>(<span class="hljs-number">8&#x27;h50</span>),<br>    <span class="hljs-variable">.WR1_LOAD</span>(!DLY_RST_0),<br>    <span class="hljs-variable">.WR1_CLK</span>(~D5M_PIXLCLK),<br><br>    <span class="hljs-comment">//	FIFO Write Side 2</span><br>    <span class="hljs-variable">.WR2_DATA</span>(&#123;<span class="hljs-number">1&#x27;b0</span>, w_g[<span class="hljs-number">4</span>:<span class="hljs-number">0</span>], w_r[<span class="hljs-number">9</span>:<span class="hljs-number">0</span>]&#125;),<br>    <span class="hljs-variable">.WR2</span>(sCCD_DVAL),<br>    <span class="hljs-variable">.WR2_ADDR</span>(<span class="hljs-number">23&#x27;h100000</span>),<br>    <span class="hljs-variable">.WR2_MAX_ADDR</span>(<span class="hljs-number">23&#x27;h100000</span> + <span class="hljs-number">640</span> * <span class="hljs-number">480</span>),<br>    <span class="hljs-variable">.WR2_LENGTH</span>(<span class="hljs-number">8&#x27;h50</span>),<br>    <span class="hljs-variable">.WR2_LOAD</span>(!DLY_RST_0),<br>    <span class="hljs-variable">.WR2_CLK</span>(~D5M_PIXLCLK),<br><br>    <span class="hljs-comment">//	FIFO Read Side 1</span><br>    <span class="hljs-variable">.RD1_DATA</span>(Read_DATA1),<br>    <span class="hljs-variable">.RD1</span>(Read),<br>    <span class="hljs-variable">.RD1_ADDR</span>(<span class="hljs-number">0</span>),<br>    <span class="hljs-variable">.RD1_MAX_ADDR</span>(<span class="hljs-number">640</span> * <span class="hljs-number">480</span>),<br>    <span class="hljs-variable">.RD1_LENGTH</span>(<span class="hljs-number">8&#x27;h50</span>),<br>    <span class="hljs-variable">.RD1_LOAD</span>(!DLY_RST_0),<br>    <span class="hljs-variable">.RD1_CLK</span>(~VGA_CTRL_CLK),<br><br>    <span class="hljs-comment">//	FIFO Read Side 2</span><br>    <span class="hljs-variable">.RD2_DATA</span>(Read_DATA2),<br>    <span class="hljs-variable">.RD2</span>(Read),<br>    <span class="hljs-variable">.RD2_ADDR</span>(<span class="hljs-number">23&#x27;h100000</span>),<br>    <span class="hljs-variable">.RD2_MAX_ADDR</span>(<span class="hljs-number">23&#x27;h100000</span> + <span class="hljs-number">640</span> * <span class="hljs-number">480</span>),<br>    <span class="hljs-variable">.RD2_LENGTH</span>(<span class="hljs-number">8&#x27;h50</span>),<br>    <span class="hljs-variable">.RD2_LOAD</span>(!DLY_RST_0),<br>    <span class="hljs-variable">.RD2_CLK</span>(~VGA_CTRL_CLK),<br><br>    <span class="hljs-comment">//	SDRAM Side</span><br>    <span class="hljs-variable">.SA</span>(DRAM_ADDR),<br>    <span class="hljs-variable">.BA</span>(DRAM_BA),<br>    <span class="hljs-variable">.CS_N</span>(DRAM_CS_N),<br>    <span class="hljs-variable">.CKE</span>(DRAM_CKE),<br>    <span class="hljs-variable">.RAS_N</span>(DRAM_RAS_N),<br>    <span class="hljs-variable">.CAS_N</span>(DRAM_CAS_N),<br>    <span class="hljs-variable">.WE_N</span>(DRAM_WE_N),<br>    <span class="hljs-variable">.DQ</span>(DRAM_DQ),<br>    <span class="hljs-variable">.DQM</span>(&#123;DRAM_UDQM, DRAM_LDQM&#125;)<br>);<br></code></pre></td></tr></table></figure>
</li>
</ul>
<hr />
<h3 id="管脚分配"><a class="markdownIt-Anchor" href="#管脚分配"></a> 管脚分配</h3>
<ul>
<li>
<p>项目基于黄金系统设计参考（Golden Sys­tem Ref­er­ence De­sign, GSRD）进行开发</p>
<ul>
<li>GSRD 是一套由 In­tel 和开发板厂商以及开源社区共同维护的设计参考模板，提供了现成的管脚绑定和顶层模块设计。基于该参考模板进行开发能够减少开发工作量，提高设计效率。</li>
<li>DE1-SoC 的设计参考可以在官方网站中找到[<a target="_blank" rel="noopener" href="http://mail.terasic.com.cn/~dongliu/DE1_SOC/DE1_SoC_D5M_GPIO1.zip">4</a>]</li>
</ul>
</li>
<li>
<p>因此只需导入官方提供的设计文件即可</p>
<p><img src="19.png" srcset="/img/loading.gif" lazyload alt="" /></p>
</li>
</ul>
<hr />
<h3 id="综合并下载"><a class="markdownIt-Anchor" href="#综合并下载"></a> 综合并下载</h3>
<ul>
<li>
<p>使用 Quartus 进行项目综合，结果如下</p>
<p><img src="20.png" srcset="/img/loading.gif" lazyload alt="" /></p>
</li>
<li>
<p>将板卡连接开发上位机，并通过VGA连接显示器，打开FPGA电源后即可通过 Quartus 内置的设备管理器将综合后的文件烧录到板卡中，之后即可在显示器上观察到边缘检测后的视频。</p>
</li>
</ul>
<hr />
<h3 id="实现效果"><a class="markdownIt-Anchor" href="#实现效果"></a> 实现效果</h3>
<ul>
<li>
<p>设备可以将摄像头拍摄到的视频中的物体的边缘高亮，但是在光线明暗变化较多、物品堆放复杂的场景下，边缘检测的表现不佳</p>
<p><img src="22.png" srcset="/img/loading.gif" lazyload alt="" /></p>
</li>
<li>
<p>此外，视频流的帧数相较原项目也存在略微降低，视频容易出现卡顿</p>
</li>
</ul>
<hr />
<h2 id="五-项目结果总结"><a class="markdownIt-Anchor" href="#五-项目结果总结"></a> 五、项目结果总结</h2>
<ul>
<li>本项目圆满完成边缘检测这一需求，且在光线较好、物品单一环境中有较好的表现</li>
<li>项目中还存在边缘检测算法的抗干扰能力不强，无法在复杂光照与复杂场景中准确识别各个物体的边缘的问题
<ul>
<li>在未来可以考虑对图像进行均值滤波或高斯模糊等的预处理，降低视频噪点</li>
<li>可以考虑微调边缘检测阈值，或者设置外部输入以动态调整阈值，提高设备在不同光照条件下的泛用型</li>
<li>可以考虑更换新的算子</li>
</ul>
</li>
<li>边缘检测作为图像处理的基础，该项目在未来可以考虑融合神经网络，基于边缘高亮的图形做一些类型识别等的工作，如车牌号识别，或是特定物品高亮等</li>
<li>这是作者第一次接触图像处理相关的内容，学到了很多关于图像处理的知识，比如色彩空间转换和各种边缘检测算子。除此之外，对于硬件中流数据的处理以及流水线的设计有了更深刻的认识</li>
</ul>
<hr />
<h2 id="六-参考资料"><a class="markdownIt-Anchor" href="#六-参考资料"></a> 六、参考资料</h2>
<p>[1]<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/28766366">Chapter 3 颜色空间（2）——YUV、YCbCr</a></p>
<p>[2]<a target="_blank" rel="noopener" href="https://www.intel.cn/content/www/cn/zh/docs/programmable/683241/21-1/shift-register-ram-based-general-description.html">Shift Register (基于RAM) Intel® FPGA IP常规描述</a></p>
<p>[3]<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/40491339">OpenCV图像处理|1.17 Sobel算子</a></p>
<p>[4]<a target="_blank" rel="noopener" href="http://mail.terasic.com.cn/~dongliu/DE1_SOC/DE1_SoC_D5M_GPIO1.zip">DE1-SoC Board</a></p>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/%E9%A1%B9%E7%9B%AE%E6%8A%A5%E5%91%8A/">项目报告</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/FPGA/">FPGA</a>
                    
                      <a class="hover-with-bg" href="/tags/%E9%A1%B9%E7%9B%AE%E6%8A%A5%E5%91%8A/">项目报告</a>
                    
                      <a class="hover-with-bg" href="/tags/%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86/">图像处理</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">
                  
                    本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！
                  
                </p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/%E7%9C%8B%E7%82%B9%E8%AE%BA%E6%96%87/MapReduce/">
                        <span class="hidden-mobile">分布式系统 | MapReduce</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
              <!-- Comments -->
              <article class="comments" id="comments" lazyload>
                
                  
                
                
  <div id="valine"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#valine', function() {
      Fluid.utils.createScript('https://cdn.jsdelivr.net/npm/valine@1/dist/Valine.min.js', function() {
        var options = Object.assign(
          {"appId":"ju71pT7Kr10EISdANOvPh7gC-gzGzoHsz","appKey":"FoQggxB4tHGzYQQoLrF0qKux","path":"window.location.pathname","placeholder":"吐槽","avatar":"retro","meta":["nick","mail","link"],"requiredFields":[],"pageSize":10,"lang":"zh-CN","highlight":false,"recordIP":false,"serverURLs":"","emojiCDN":null,"emojiMaps":null,"enableQQ":false},
          {
            el: "#valine",
            path: window.location.pathname
          }
        )
        new Valine(options);
        Fluid.utils.waitElementVisible('#valine .vcontent', () => {
          Fluid.plugins.initFancyBox('#valine .vcontent img:not(.vemoji)');
        })
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


              </article>
            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
  
  <div class="statistics">
    
    

    
      
        <!-- 不蒜子统计PV -->
        <span id="busuanzi_container_site_pv" style="display: none">
            总访问量 
            <span id="busuanzi_value_site_pv"></span>
             次
          </span>
      
      
        <!-- 不蒜子统计UV -->
        <span id="busuanzi_container_site_uv" style="display: none">
            总访客数 
            <span id="busuanzi_value_site_uv"></span>
             人
          </span>
      
    
  </div>


  

  
</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  <script  src="/js/local-search.js" ></script>



  
    <script  src="/js/img-lazyload.js" ></script>
  



  



  
    <script  src="https://cdn.jsdelivr.net/npm/tocbot@4/dist/tocbot.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4/anchor.min.js" ></script>
  
  
    <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js" ></script>
  



  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>




  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
        typing(title);
      
    })(window, document);
  </script>





  

  
    <!-- KaTeX -->
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0/dist/katex.min.css" />
  











<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>


</body>
</html>
